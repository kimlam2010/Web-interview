{% extends 'layouts/base.html' %}
{% block title %}Audit Logs{% endblock %}
{% block content %}
  <h1 class="h4 mb-3">Audit Logs</h1>
  <form class="row g-2 mb-3" method="get">
    <div class="col-md-3"><input class="form-control" name="user_id" value="{{ user_id or '' }}" placeholder="User ID"></div>
    <div class="col-md-3"><input class="form-control" name="action" value="{{ action or '' }}" placeholder="Action"></div>
    <div class="col-md-2"><input class="form-control" name="from" value="{{ date_from or '' }}" placeholder="From (YYYY-MM-DD)"></div>
    <div class="col-md-2"><input class="form-control" name="to" value="{{ date_to or '' }}" placeholder="To (YYYY-MM-DD)"></div>
    <div class="col-md-2"><button class="btn btn-outline-secondary w-100">Lọc</button></div>
  </form>
  <div class="table-responsive">
    <table class="table table-sm table-striped align-middle">
      <thead><tr><th>Thời gian</th><th>User</th><th>Action</th><th>Resource</th><th>IP</th><th>Chi tiết</th></tr></thead>
      <tbody>
        {% for l in logs %}
        <tr>
          <td>{{ l.timestamp }}</td>
          <td>{{ l.user_id or '-' }}</td>
          <td><code>{{ l.action }}</code></td>
          <td>{{ l.resource_type }} {{ l.resource_id or '' }}</td>
          <td>{{ l.ip_address }}</td>
          <td><small class="text-muted">{{ l.details }}</small></td>
        </tr>
        {% else %}
        <tr><td colspan="6" class="text-center text-muted">Không có bản ghi</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% if pagination and pagination.pages > 1 %}
    <nav>
      <ul class="pagination">
        <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}"><a class="page-link" href="?page={{ pagination.prev_num }}&user_id={{ user_id }}&action={{ action }}&from={{ date_from }}&to={{ date_to }}">«</a></li>
        {% for p in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
          {% if p %}
            <li class="page-item {% if p == pagination.page %}active{% endif %}"><a class="page-link" href="?page={{ p }}&user_id={{ user_id }}&action={{ action }}&from={{ date_from }}&to={{ date_to }}">{{ p }}</a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">…</span></li>
          {% endif %}
        {% endfor %}
        <li class="page-item {% if not pagination.has_next %}disabled{% endif %}"><a class="page-link" href="?page={{ pagination.next_num }}&user_id={{ user_id }}&action={{ action }}&from={{ date_from }}&to={{ date_to }}">»</a></li>
      </ul>
    </nav>
  {% endif %}
{% endblock %}


